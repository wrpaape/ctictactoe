#ifndef TICTACTOE_TICTACTOE_DISPLAY_H_
#define TICTACTOE_TICTACTOE_DISPLAY_H_

#ifdef __cplusplus /* ensure C linkage */
extern "C" {
#ifndef restrict /* replace 'restrict' with c++ compatible '__restrict__' */
#define restrict __restrict__
#endif
#endif


/* EXTERNAL DEPENDENCIES
 * ▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼ */

#include "tictactoe_token.h"		/* struct Token */
#include <system_utils/stdio_utils.h>	/* stdio winsizee, misc handlers */

/* ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲
 * EXTERNAL DEPENDENCIES
 *
 *
 * CONSTANTS
 * ▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼ */

/* full window dimensions */

#define MAX_ROWS 54ul
#define MAX_COLS 181ul
#define MAX_DISPLAY_SIZE (MAX_ROWS * MAX_COLS * UTF8_MAX_SIZE)

/* ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲
 * CONSTANTS
 *
 *
 * TYPEDEFS, ENUM AND STRUCT DEFINITIONS
 * ▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼ */

struct DisplayLineJoins {
	const char *left;			/* ┌ ├ └ */
	const char *center;			/* ┬ ┼ ┴ */
	const char *right;			/* ┐ ┤ ┘ */
};

struct DisplayLineSpec {
	const char *horiz;
	const char *vert;
	struct DisplayLineJoins top;
	struct DisplayLineJoins mid;
	struct DisplayLineJoins bot;
};

struct DisplayCell {
	bool is_marked;
	struct TokenMark *mark;	/* mark or placeholder */
};

struct DisplayBuffer {
	char *active;	/* start of unsettled portion */
	char complete[MAX_DISPLAY_SIZE];
};

struct DisplayString {
	struct DisplayBuffer buffer;		/* string representation */
	struct DisplayCell *cells;		/* stateful */
	struct DisplayLineSpec line_pieces;	/* config on setup */
};


struct DisplayDimSpec {
	double pad_ratio;	/* pad / total */
	unsigned int pad;
	unsigned int fill;
	unsigned int total;
};

struct DisplayDimGroup {
	struct DisplayDimSpec board;	/* stateful */
	struct DisplayDimSpec cell;	/* stateful */
};

struct DisplayDims {
	unsigned int cell_count;	/* config on setup */
	struct winsize window;
	struct DisplayDimGroup x;
	struct DisplayDimGroup y;
};

struct Display {
	struct DisplayDims dims;		/* stateful */
	struct DisplayString string;		/* stateful */
};

/* ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲
 * TYPEDEFS, ENUM AND STRUCT DEFINITIONS
 *
 *
 * FUNCTION-LIKE MACROS
 * ▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼ */
/* ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲
 * FUNCTION-LIKE MACROS
 *
 *
 * TOP-LEVEL FUNCTIONS
 * ▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼ */

inline void display_init(struct *const restrict Display display,
			 const unsigned int *const restrict io_move_map,
			 const unsigned int cell_count)
{
	dims_init(&display->dims,
		  cell_count);

	string_init(&display->string,
		    io_move_map,
		    cell_count);

}


/* ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲
 * TOP-LEVEL FUNCTIONS
 *
 *
 * HELPER FUNCTIONS
 * ▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼ */

static inline void dims_init(struct *const restrict DisplayDims dims,
			     const unsigned int cell_count);

static inline void dim_group_init(struct *const restrict DisplayDimGroup group,
				  const unsigned int board_total,
				  const unsigned int cell_count,
				  const double board_pad_ratio,
				  const double cell_pad_ratio);

static inline void dim_spec_init(struct *const restrict DisplayDimSpec spec,
				 const double pad_ratio,
				 const unsigned int total);

static inline void dim_spec_resize(struct *const restrict DisplayDimSpec spec,
				   const unsigned int new_total);
/* ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲
 * HELPER FUNCTIONS */


#ifdef __cplusplus /* close 'extern "C" {' */
}
#endif

#endif /* ifndef TICTACTOE_TICTACTOE_DISPLAY_H_ */
